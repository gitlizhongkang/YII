$(function () {
   $(document).on("change",".upfile",function(){
       var $this = $(this).parents('.new_portrait'),
           btn = $this.find('.upfile'),
           img = $this.find('img');
           imgurl = $this.find('.imgurl');
            var file = $(this)[0].files[0],
                imgSrc = $(this)[0].value,
                url = URL.createObjectURL(file);
            if (!/\.(jpg|jpeg|png|JPG|PNG|JPEG)$/.test(imgSrc)){
                alert("请上传jpg或png格式的图片！");
                return false;
            }else{
                var formData = new FormData();
                formData.append("myfile", file);
                $.ajax({
                    url: check_logo,
                    type: "POST",
                    data: formData,
                    contentType: false,
                    processData: false,
                    dataType:"json",
                    success: function (data) {
                        if (data['msg'] == "1") {
                            alert("上传成功！");
                            img.attr('src',url);
                            img.css({'opacity':'1'});
                            imgurl.val(data['path']);
                        }
                        if (data['msg'] == "2") {
                            alert("上传失败!");
                        }
                    },
                    error: function () {
                        alert("上传失败！");
                    }
                });
            }
        });
    $("#addMember").click(function () {
        var a = $(".formWrapper").length, b = $("#companyId").val();
        2 == a && $(this).hide(), $("#memberDiv").append('<div class="formWrapper"><input type="hidden" name="leaderInfos[' + a + '][companyId]" value="' + b + '" />' +'<div class="new_portrait"><div class="preview"><img class="imghead" width=120 height=100> </div> <input type="file" class="upfile" accept="*/*"> <input class="btn" type="button"  value="上传头像"  /> <input type="hidden" class="imgurl" name="leaderInfos[' + a + '][photo]"></div>'  + "<h3>创始人姓名</h3>" + '<input type="text" class="s_input1" id="name' + a + '" name="leaderInfos[' + a + '][name]" placeholder="请输入创始人姓名" />' + "<h3>当前职位</h3>" + '<input type="text" class="s_input1" id="position' + a + '" name="leaderInfos[' + a + '][position]" placeholder="请输入当前职位，如：创始人兼CEO" />' + "<h3>新浪微博</h3>" + '<input type="text" id="weibo' + a + '" name="leaderInfos[' + a + '][weibo]" placeholder="请输入新浪微博地址" />' + "<h3>创始人简介</h3>" + '<textarea class="s_textarea" id="description' + a + '" name="leaderInfos[' + a + '][remark]" maxlength="1000" placeholder="请输入该创始人的个人履历等，建议按照时间倒序分条展示"></textarea>' + '<div class="word_count">你还可以输入 <span>500</span> 字</div>' + "</div>"), $(".formWrapper").each(function (b) {
            b != a && $(this).css({borderBottom: "1px solid #555", paddingBottom: "20px"})
        })
    }), $("#memberDiv").on("keyup", "textarea", function () {
        var a = $(this);
        a.val().length > 500 ? a.val(a.val().substring(0, 500)) : a.siblings(".word_count").children("span").text(500 - a.val().length)
    }), $("#memberForm").on("mouseenter", ".new_portrait input", function () {
        $(".portrait_upload").css("backgroundColor", "#7e9597")
    }), $("#memberForm").on("mouseleave", ".new_portrait input", function () {
        $(".portrait_upload").css("backgroundColor", "#e7e7e7")
    }), $("#memberForm").validate({
        onkeyup: !1,
        focusCleanup: !0,
        rules: {
            "leaderInfos[0][name]": {required: !1, minlength: 2, maxlenStr: 20},
            "leaderInfos[0][position]": {required: !1, maxlenStr: 60},
            "leaderInfos[0][weibo]": {required: !1, maxlength: 120},
            "leaderInfos[0][remark]": {required: !1,  minlength: 10, maxlength: 500},
            "leaderInfos[1][name]": {required: !1, minlength: 2, maxlenStr: 20},
            "leaderInfos[1][position]": {required: !1,  maxlenStr: 60},
            "leaderInfos[1][weibo]": {required: !1,  maxlength: 120},
            "leaderInfos[1][remark]": {required: !1,  minlength: 10, maxlength: 500},
            "leaderInfos[2][name]": {required: !1,  minlength: 2, maxlenStr: 20},
            "leaderInfos[2][position]": {required: !1,  maxlenStr: 60},
            "leaderInfos[2][weibo]": {required: !1,  maxlength: 120},
            "leaderInfos[2][remark]": {required: !1,  minlength: 10, maxlength: 500}
        },
        messages: {
            "leaderInfos[0][name]": {
                specialchar: "请输入真实的创始人姓名",
                minlength: "请输入真实的创始人姓名",
                maxlenStr: "请输入真实的创始人姓名"
            },
            "leaderInfos[0][position]": {maxlenStr: "请输入真实的当前职位"},
            "leaderInfos[0][weibo]": {maxlength: "请输入120字符以内的网址"},
            "leaderInfos[0][remark]": {
                minlength: "请输入10-500字的个人简介",
                maxlength: "请输入10-500字的个人简介"
            },
            "leaderInfos[1][name]": {
                minlength: "请输入真实的创始人姓名",
                maxlenStr: "请输入真实的创始人姓名"
            },
            "leaderInfos[1][position]": {maxlenStr: "请输入真实的当前职位"},
            "leaderInfos[1][weibo]": {maxlength: "请输入120字符以内的网址"},
            "leaderInfos[1][remark]": {
                minlength: "请输入10-500字的个人简介",
                maxlength: "请输入10-500字的个人简介"
            },
            "leaderInfos[2][name]": {
                minlength: "请输入真实的创始人姓名",
                maxlenStr: "请输入真实的创始人姓名"
            },
            "leaderInfos[2][position]": {maxlenStr: "请输入真实的当前职位"},
            "leaderInfos[2][weibo]": {maxlength: "请输入120字符以内的网址"},
            "leaderInfos[2][remark]": {
                minlength: "请输入10-500字的个人简介",
                maxlength: "请输入10-500字的个人简介"
            }
        },
        submitHandler: function (a) {
            var b = $(a).find('input[type="text"]'), c = $(a).find("textarea"),d=$(a).find('input[type="hidden"]');
            b.each(function () {
                $(this).val() == $(this).attr("placeholder") && $(this).val()
            }),d.each(function () {
                $(this).val() == $(this).attr("placeholder") && $(this).val()
            }),c.each(function () {
                $(this).text() == $(this).attr("placeholder") && $(this).text()
            }),$(a).find(":submit").attr("disabled", !0), a.submit()
        }
    })
});