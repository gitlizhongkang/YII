$(function () {
    $(document).on("change",".upfile",function(){
        var $this = $(this).parents('.new_product'),
            btn = $this.find('.upfile'),
            img = $this.find('img');
        dd=$this.find(".on");
        tt=$this.find(".show");
        imgurl = $this.find('.imgurl');
        var file = $(this)[0].files[0],
            imgSrc = $(this)[0].value,
            url = URL.createObjectURL(file);
        if (!/\.(jpg|jpeg|png|JPG|PNG|JPEG)$/.test(imgSrc)){
            alert("请上传jpg或png格式的图片！");
            return false;
        }else{
                dd.hide();
                tt.show();
                img.attr('src',url);
                img.css({'opacity':'1'});
                var tt=window.confirm("是否确定上传？");
                if(!tt){
                    return false;
                }else{
                    var formData = new FormData();
                    formData.append("myfile", file);
                    $.ajax({
                        url: check_logo,
                        type: "POST",
                        data: formData,
                        contentType: false,
                        processData: false,
                        dataType:"json",
                        success: function (data) {
                            if (data['msg'] == "1") {
                                alert("上传成功！");
                                btn.attr('disabled','disabled');
                                imgurl.val(data['path']);
                            }
                            if (data['msg'] == "2") {
                                alert("上传失败!");
                            }
                        },
                        error: function () {
                            alert("上传失败！");
                        }
                    });
                }
        }
    });
    $("#addMember").click(function () {
        var a = $(".formWrapper").length, b = $("#companyId").val();
        2 == a && $(this).hide(), $("#productDiv").append('<div class="formWrapper"><input type="hidden" name="productInfos[' + a + '][companyId]" value="' + b + '" />' + "<h3>产品海报</h3>" + '<div class="new_product mt20">' + '<div class="product_upload on" id="productNo' + a + '">' + "<div><span>上传产品图片</span> <br />	尺寸：380*220px  	大小：小于5M</div>" + "</div>" + '<div class="product_upload dn productShow show" id="productShow' + a + '">' + '<img src="" width="380" height="220" />' + "<span>更换产品图片<br />380*220px 小于5M</span>" + '</div><input type="file" name="myfiles" id="myfiles0" class="upfile" accept="*/*"><input type="hidden" class="imgurl" name="productInfos[' + a + '][photo]"> </div>' + '<span class="error" id="myfiles' + a + '_error" style="display:none;"></span>' + "<h3>产品名称</h3>" + '<input type="text" id="name' + a + '" name="productInfos[' + a + '][product]" placeholder="请输入产品名称" />' + "<h3>产品地址</h3>" + '<input type="text" id="address' + a + '" name="productInfos[' + a + '][productUrl]" placeholder="请输入产品主页URL或产品下载地址" />' + "<h3>产品简介</h3>" + '<textarea id="description' + a + '" name="productInfos[' + a + '][productProfile]" maxlength="1000" placeholder="请输入该创始人的个人履历等，建议按照时间倒序分条展示"></textarea>' + '<div class="word_count">你还可以输入 <span>500</span> 字</div>' + "</div>"), $(".formWrapper").each(function (b) {
            b != a && $(this).css({borderBottom: "1px solid #555", paddingBottom: "20px"})
        })
    }), $("#productDiv").on("keyup", "textarea", function () {
        var a = $(this);
        a.val().length > 500 ? a.val(a.val().substring(0, 500)) : a.siblings(".word_count").children("span").text(500 - a.val().length)
    }), $("#productForm").on("mouseenter", ".new_product input", function () {
        $(".product_upload div").css("backgroundColor", "#7e9597")
    }), $("#productForm").on("mouseleave", ".new_product input", function () {
        $(".product_upload div").css("backgroundColor", "#93b7bb")
    }), $("#productForm").validate({
        onkeyup: !1,
        focusCleanup: !0,
        rules: {
            "productInfos[0][product]": {required: !1, minlength: 2, maxlenStr: 20},
            "productInfos[0][productUrl]": {required: !1, checkUrlNot: !0, maxlength: 120},
            "productInfos[0][productProfile]": {
                required: !1,
                specialchar: !0,
                checkNum: !0,
                minlength: 10,
                maxlength: 500
            },
            "productInfos[1][product]": {required: !1, minlength: 2, maxlenStr: 20},
            "productInfos[1][productUrl]": {required: !1, checkUrlNot: !0, maxlength: 120},
            "productInfos[1][productProfile]": {
                required: !1,
                specialchar: !0,
                checkNum: !0,
                minlength: 10,
                maxlength: 500
            },
            "productInfos[2][product]": {required: !1, minlength: 2, maxlenStr: 20},
            "productInfos[2][productUrl]": {required: !1, checkUrlNot: !0, maxlength: 120},
            "productInfos[2][productProfile]": {
                required: !1,
                specialchar: !0,
                checkNum: !0,
                minlength: 10,
                maxlength: 500
            }
        },
        messages: {
            "productInfos[0][product]": {minlength: "请输入有效的产品名称", maxlenStr: "请输入有效的产品名称"},
            "productInfos[0][productUrl]": {checkUrlNot: "请输入有效的产品主页或产品下载地址", maxlength: "请输入120字符以内的网址"},
            "productInfos[0][productProfile]": {
                specialchar: "请输入有效的产品简介",
                checkNum: "请输入有效的产品简介",
                minlength: "请输入10-500字的产品简介",
                maxlength: "请输入10-500字的产品简介"
            },
            "productInfos[1][product]": {minlength: "请输入有效的产品名称", maxlenStr: "请输入有效的产品名称"},
            "productInfos[1][productUrl]": {checkUrlNot: "请输入有效的产品主页或产品下载地址", maxlength: "请输入120字符以内的网址"},
            "productInfos[1][productProfile]": {
                specialchar: "请输入有效的产品简介",
                checkNum: "请输入有效的产品简介",
                minlength: "请输入10-500字的产品简介",
                maxlength: "请输入10-500字的产品简介"
            },
            "productInfos[2][product]": {minlength: "请输入有效的产品名称", maxlenStr: "请输入有效的产品名称"},
            "productInfos[2][productUrl]": {checkUrlNot: "请输入有效的产品主页或产品下载地址", maxlength: "请输入120字符以内的网址"},
            "productInfos[2][productProfile]": {
                specialchar: "请输入有效的产品简介",
                checkNum: "请输入有效的产品简介",
                minlength: "请输入10-500字的产品简介",
                maxlength: "请输入10-500字的产品简介"
            }
        },
        submitHandler: function (a) {
            var b = $(a).find('input[type="text"]'), c = $(a).find("textarea"),d=$(a).find('input[type="hidden"]');
            b.each(function () {
                $(this).val() == $(this).attr("placeholder") && $(this).val()
            }),d.each(function () {
                $(this).val() == $(this).attr("placeholder") && $(this).val()
            }), c.each(function () {
                $(this).text() == $(this).attr("placeholder") && $(this).text()
            }), $(a).find(":submit").attr("disabled", !0), a.submit()
        }
    })
});