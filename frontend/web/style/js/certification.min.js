$(function () {
    $(document).on("change",".upfile",function(){
        var $this = $(this).parents('.new_product'),
            btn = $this.find('.upfile'),
            img = $this.find('img');
        dd=$this.find(".on");
        tt=$this.find(".show");
        imgurl = $this.find('.imgurl');
        var file = $(this)[0].files[0],
            imgSrc = $(this)[0].value,
            url = URL.createObjectURL(file);
        if (!/\.(jpg|jpeg|png|JPG|PNG|JPEG)$/.test(imgSrc)){
            alert("请上传jpg或png格式的图片！");
            return false;
        }else{
            dd.hide();
            tt.show();
            img.attr('src',url);
            img.css({'opacity':'1'});
            var tt=window.confirm("是否确定上传？");
            if(!tt){
                return false;
            }else{
                var formData = new FormData();
                formData.append("myfile", file);
                $.ajax({
                    url: check,
                    type: "POST",
                    data: formData,
                    contentType: false,
                    processData: false,
                    dataType:"json",
                    success: function (data) {
                        if (data['msg'] == "1") {
                            alert("上传成功！");
                            btn.attr('disabled','disabled');
                            window.location.href=checksuccess+"&companyid="+data['id'];
                        }
                        if (data['msg'] == "2") {
                            alert("上传失败!");
                        }
                    },
                    error: function () {
                        alert("上传失败！");
                    }
                });
            }
        }
    });
});